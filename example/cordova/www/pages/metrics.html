<template>
  <div class="page">

    <!-- Navbar -->
    <div class="navbar">
      <div class="navbar-inner">
        <div class="left">
          <a href="#" class="link icon-only panel-open" data-panel="left">
            <i class="icon f7-icons ios-only">menu</i>
            <i class="icon material-icons md-only">menu</i>
          </a>
        </div>
        <div class="title sliding">Metrics</div>
      </div>
    </div>

    <!-- Contents -->

    <div class="page-content">
      <div>
        <h4>Metrics:</h4>
        <p id="metrics-info"></p>
      </div>

      <div class="block block-strong">
        <a href="#" class="button button-raised" @click="sendMetrics">Send metrics</a>
      </div>

      <div>
        <h4>Response:</h4>
        <p id="response-info"></p>
      </div>
    </div>

  </div>
</template>

<style>
  .page-content {
    margin: 12px;
  }
</style>

<script>
  return {
    beforeCreate() {
      var self = this;
      self.$("#metrics-info").html("Fetching metrics...");

      self.metricsService = new aerogear.core.MetricsService({ url: "http://192.168.1.6:3000/metrics" });
      self.metricsService.getAppAndDeviceMetrics()
        .then(metrics => {
          self.$("#metrics-info").html(JSON.stringify(metrics));
        })
        .catch(error => {
          self.$("#metrics-info").html(error)
        });
    },
    data: function () {
      return {}
    },
    methods: {
      sendMetrics: function (success, error) {
        var self = this;
        self.$("#response-info").html("Sending metrics...");
        self.metricsService.sendAppAndDeviceMetrics()
          .then(res => {
            self.$("#response-info").html(JSON.stringify(res.status));
          })
          .catch(error => {
            self.$("#response-info").html(JSON.stringify(error));
          });
      },
    }
  };
</script>
